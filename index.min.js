"use strict";function _refError(a){console.error("Firebase refError()"),console.error(a)}function _generateElement(a,b){if(!a)return console.error("_generateElement missing data");if(!b)return console.error("_generateElement missing key");var c="";switch(a.tag){case"circle":if(!(a.r&&a.cx&&a.cy))return;c+='<circle objid="'+b+'" id="t'+b+'" r="'+a.r+'"',a.color&&(c+=' class="c'+a.color+'"'),a.cx&&(c+=' cx="'+a.cx+'"'),a.cy&&(c+=' cy="'+a.cy+'"'),c+="></circle>";break;case"rect":if(!(a.x&&a.y&&a.width&&a.height))return;c+='<rect objid="'+b+'" id="t'+b+'" width="'+a.width+'" height="'+a.height+'"',a.color&&(c+=' class="c'+a.color+'"'),a.x&&(c+=' x="'+a.x+'"'),a.y&&(c+=' y="'+a.y+'"'),c+="></rect>";break;default:console.error("Unknown element tag: "+a.tag)}return c}function _generateElementObj(a,b){if(!a)return console.error("_generateElement missing data");if(!b)return console.error("_generateElement missing key");var c="";switch(a.tag){case"circle":if(!(a.r&&a.cx&&a.cy))return;c=document.createElementNS("http://www.w3.org/2000/svg","circle"),c.setAttributeNS(null,"objid",b),c.setAttributeNS(null,"id","t"+b),c.setAttributeNS(null,"r",a.r),c.setAttributeNS(null,"cx",a.cx),c.setAttributeNS(null,"cy",a.cy),a.color&&c.setAttributeNS(null,"class","c"+a.color);break;case"rect":if(!(a.x&&a.y&&a.width&&a.height))return;c=document.createElementNS("http://www.w3.org/2000/svg","rect"),c.setAttributeNS(null,"objid",b),c.setAttributeNS(null,"id","t"+b),c.setAttributeNS(null,"x",a.x),c.setAttributeNS(null,"y",a.y),c.setAttributeNS(null,"width",a.width),c.setAttributeNS(null,"height",a.height),a.color&&c.setAttributeNS(null,"class","c"+a.color);break;default:console.error("Unknown element tag: "+a.tag)}return c}function _vectic_template(a){var b=this;return this.refError=_refError,a=a||{},this.id=a.id||null,this.target=a.target||null,this.path=a.path||null,this.id?this.target?this.path?this.target&&!this.target.html?console.error("vectic_template(): Target is not correct JQuery DOM object"):("undefined"!=typeof Firebase?this.firebaseLib=Firebase:console.error("_vectic_template(): could not find Firebase library"),this.onValue=function(c,d){var e=c.val(),f=c.key();if(!(e&&e.settings&&e.settings.width&&e.settings.height&&e.elements))return console.error("template "+f+" incomplete");var g="0 0 "+e.settings.width+" "+e.settings.height;b.target.get(0).setAttributeNS(null,"viewBox",g),e.palette&&b.target.get(0).setAttributeNS(null,"class","p"+e.palette);var h="";for(var i in e.elements){var j=e.elements[i];h+=_generateElement(j,i)}b.target.html(h),a.rootid&&document.querySelector("svg#"+a.rootid).setAttributeNS(null,"id",a.rootid)},this.destroy=function(){},this.templateDef=new this.firebaseLib(this.path+this.id),void this.templateDef.on("value",this.onValue,this.refError)):console.error("vectic_template(): No path supplied"):console.error("vectic_template(): No Target template element supplied"):console.error("vectic_template(): No ID supplied")}function _vectic_palette(a){var b=this;return this.refError=_refError,a=a||{},this.id=a.id||null,this.target=a.target||null,this.path=a.path||null,this.id?this.target?this.path?this.target&&!this.target.html?console.error("vectic_palette(): Target is not correct JQuery DOM object"):("undefined"!=typeof Firebase?this.firebaseLib=Firebase:console.error("_vectic_palette(): could not find Firebase library"),this.onValue=function(c,d){var e=c.val();if(e||!e.colors){var f="";for(var g in e.colors){var h=e.colors[g];f+=".p"+b.id+" .c"+g+" {",void 0!=h.fill&&(f+="fill:"+h.fill+";"),void 0!=h.stroke&&(f+="stroke:"+h.stroke+";"),void 0!=h["stroke-width"]&&(f+="stroke-width:"+h["stroke-width"]+";"),f+="} "}b.target.html(f),a.rootid&&document.querySelector("svg#"+a.rootid).setAttributeNS(null,"id",a.rootid)}},this.destroy=function(){},this.paletteDef=new this.firebaseLib(this.path+this.id),void this.paletteDef.on("value",this.onValue,this.refError)):console.error("vectic_palette(): No path supplied"):console.error("vectic_palette(): No Target palette element supplied"):console.error("vectic_palette(): No ID supplied")}function vectic(a){a=a||{};var b=this;return this.refError=_refError,this.targetObject=a.target,this.targetObjectSvg=null,this.vecticID=a.vecticID,this.templateID=a.templateID,this.firebaseLib=void 0,this.vecticRef=void 0,this.templateRef=void 0,this.objects={},this.templates={},this.palettes={},this.objectContainerDom=null,this.templateContainerDom=null,this.templateEditContainerDom=null,this.paletteContainerDom=null,this.vecticTemplateHandlers={},this.vecticPaletteHandlers={},this.dataSettings=null,this.sizeSettings=null,this.moveRoot=a.moveRoot||function(){},this.clickRoot=a.clickRoot||function(){},this.enterRoot=a.enterRoot||function(){},this.leaveRoot=a.leaveRoot||function(){},this.scrollRoot=a.scrollRoot||function(){},this.mouseupRoot=a.mouseupRoot||function(){},this.mousedownRoot=a.mousedownRoot||function(){},this.moveObject=a.moveObject||function(){},this.clickObject=a.clickObject||function(){},this.enterObject=a.enterObject||function(){},this.leaveObject=a.leaveObject||function(){},this.scrollObject=a.scrollObject||function(){},this.mouseupObject=a.mouseupObject||function(){},this.mousedownObject=a.mousedownObject||function(){},"undefined"!=typeof Firebase?this.firebaseLib=Firebase:console.error("vectic(): could not find Firebase library"),Object.defineProperty(this,"pathBase",{get:function(){return"http://vecticdev.firebaseio.com/"}}),Object.defineProperty(this,"pathVectic",{get:function(){return this.pathBase+"vectic/"}}),Object.defineProperty(this,"pathTemplate",{get:function(){return this.pathBase+"template/"}}),Object.defineProperty(this,"pathPalette",{get:function(){return this.pathBase+"palette/"}}),this.targetObject&&this.targetObject.html?this.vecticID||this.templateID?(this.vecticID?this.rootID="v"+this.vecticID+"_id"+(_vecticUID+=1):this.templateID&&(this.rootID="t"+this.templateID+"_id"+(_vecticUID+=1)),this.init=function(){if(!b.firebaseLib)return console.error("vectic.init(): Missing Firebase library");if(b.initStyles(),b.initHTML(),b.getDoms(),b.vecticID)b.vecticRef=new b.firebaseLib(b.pathVectic+b.vecticID),b.vecticObjectsRef=b.getObjectsRef(),b.vecticTemplatesRef=b.getTemplatesRef(),b.vecticPalettesRef=b.getPalettesRef(),b.setVecticHooks();else{if(!b.templateID)return console.error("vectic: Missing vecticID or templateID");b.templateRef=new b.firebaseLib(b.pathTemplate+b.templateID),b.vecticPalettesRef=b.getPalettesRef(),b.setTemplateHooks()}b.clickRegister()},this.initStyles=function(){if(!$("body #vecticStyler").length){var a=$('<div id="vecticStyler">'+_globalVecticStyler+"</div>");$("body").append(a)}},this.initHTML=function(){return b.targetObject?(b.targetObject.html(_htmlBoiler.replace("{{ROOTID}}",b.rootID)),void(b.targetObjectSvg=$(b.targetObject).find("svg").get(0))):console.error("vectic: Target object missing")},this.getDoms=function(){b.objectContainerDom=$("svg#"+b.rootID+" g#objects").get(0),b.templateContainerDom=$("svg#"+b.rootID+" defs#templates").get(0),b.paletteContainerDom=$("svg#"+b.rootID+" defs#palettes").get(0),b.templateEditContainerDom=$("svg#"+b.rootID+" g#templates_edit").get(0)},this.getObjectsRef=function(){return b.vecticRef||b.templateRef?(b.vecticRef||b.templateRef).child("objects"):console.error("vectic.getObjectsRef: Could not find vecticRef")},this.getTemplatesRef=function(){return b.vecticRef||b.templateRef?(b.vecticRef||b.templateRef).child("templates"):console.error("vectic.getTemplatesRef: Could not find vecticRef")},this.getPalettesRef=function(){return b.vecticRef||b.templateRef?(b.vecticRef||b.templateRef).child("palettes"):console.error("vectic.getPalettesRef: Could not find vecticRef")},this.setVecticHooks=function(){return b.vecticRef?(b.vecticPalettesRef.off("child_added",b.addPalette,b.refError),b.vecticTemplatesRef.off("child_added",b.addTemplate,b.refError),b.vecticObjectsRef.off("child_added",b.addObject,b.refError),b.vecticPalettesRef.on("child_added",b.addPalette,b.refError),b.vecticTemplatesRef.on("child_added",b.addTemplate,b.refError),b.vecticObjectsRef.on("child_added",b.addObject,b.refError),b.vecticRef.child("settings").off("value",b.settingsChange,b.refError),b.vecticRef.child("settings").on("value",b.settingsChange,b.refError),b.vecticRef.child("settings").off("value",b.saveSettingsLocal,b.refError),void b.vecticRef.child("settings").on("value",b.saveSettingsLocal,b.refError)):console.error("vectic: Could not create hooks, not connected to Database")},this.setTemplateHooks=function(){return b.templateRef?(b.vecticPalettesRef.off("child_added",b.addPalette,b.refError),b.vecticPalettesRef.on("child_added",b.addPalette,b.refError),b.templateRef.child("settings").off("value",b.settingsChange,b.refError),b.templateRef.child("settings").on("value",b.settingsChange,b.refError),b.templateRef.child("settings").off("value",b.saveSettingsLocal,b.refError),b.templateRef.child("settings").on("value",b.saveSettingsLocal,b.refError),b.templateRef.child("elements").off("child_added",b.updateTemplateEdit,b.refError),b.templateRef.child("elements").on("child_added",b.updateTemplateEdit,b.refError),b.templateRef.child("palette").off("value",b.updateTemplateEditPalette,b.refError),void b.templateRef.child("palette").on("value",b.updateTemplateEditPalette,b.refError)):console.error("vectic: Could not create hooks, not connected to Database")},this.settingsChange=function(a){var c=a.val();if(!(c&&c.width&&c.height))return console.error("vectic settingsChange: missing width/height");var d="0 0 "+c.width+" "+c.height;b.targetObjectSvg.setAttributeNS(null,"viewBox",d)},this.saveSettingsLocal=function(a){b.dataSettings=a.val(),b.updateSizing()},this.newObjectDom=function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","use");return b.setAttributeNS(null,"id",a),b},this.addObject=function(a,c){var d=a.key(),e=a.val(),f=b.newObjectDom(d);b.setObjectAttributes(f,e),b.objectContainerDom&&$(b.objectContainerDom).append(f)},this.setObjectAttributes=function(a,b){a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#t"+b.template),a.setAttributeNS(null,"x",b.x||null),a.setAttributeNS(null,"y",b.y||null),a.setAttributeNS(null,"width",b.width||null),a.setAttributeNS(null,"height",b.height||null)},this.initTemplate=_vectic_template,this.addTemplate=function(a,c){var d=a.key(),e=a.val(),f=e.template,g=b.newTemplateDom(d);b.templateContainerDom&&$(b.templateContainerDom).append(g),b.vecticTemplateHandlers[d]&&b.vecticTemplateHandlers[d].destroy(),b.vecticTemplateHandlers[d]=new b.initTemplate({id:f,rootid:b.rootID,vecticid:b.vecticID,target:g,path:b.pathTemplate})},this.newTemplateDom=function(a){return $('<svg id="t'+a+'"></svg>')},this.templateElementsChange=function(a,c){var d=a.key(),e=(a.val(),b.newTemplateDom(b.templateID));b.templateContainerDom&&$(b.templateContainerDom).append(e),b.vecticTemplateHandlers[d]&&b.vecticTemplateHandlers[d].destroy(),b.vecticTemplateHandlers[b.templateID]=new b.initTemplate({id:b.templateID,rootid:b.rootID,target:e,path:b.pathTemplate})},this.initPalette=_vectic_palette,this.addPalette=function(a,c){var d=a.key(),e=a.val(),f=e.palette,g=b.newPaletteDom(d);b.paletteContainerDom&&$(b.paletteContainerDom).append(g),b.vecticPaletteHandlers[d]&&b.vecticPaletteHandlers[d].destroy();var h={id:f,rootid:b.rootID,vecticid:b.vecticID,target:g,path:b.pathPalette};b.vecticPaletteHandlers[d]=new b.initPalette(h)},this.newPaletteDom=function(a){return $('<style id="p'+a+'"></style>')},this.updateTemplateEditPalette=function(a,c){var d=a.val(),e="#"+b.rootID+" #templates_edit",f=$(e);d&&f.get(0).setAttributeNS(null,"class","p"+d)},this.updateTemplateEdit=function(a,c){var d=a.key(),e=a.val(),f="#"+b.rootID+" #templates_edit",g=$(f).get(0),h=f+" t#"+d,i=$(h).get(0);if(!g)return console.error('updateTemplateEdit() unable to find templateEdit "'+f+'"');var j=_generateElementObj(e,d);j||(console.error("Failed to build template edit element "+d),console.error(e)),i?$(i).replaceWith(j):$(g).append(j),document.querySelector("svg#"+b.rootID).setAttributeNS(null,"id",b.rootID)},this.clickRegister=function(){return b.rootID?($("svg#"+b.rootID).on("click",function(a){var c={event:a,"this":this,rootID:b.rootID};b.clickRoot(c)}),$("svg#"+b.rootID).on("mousemove",function(a){var c={event:a,"this":this,rootID:b.rootID};b.moveRoot(c)}),$("svg#"+b.rootID).on("mouseenter",function(a){var c={event:a,"this":this,rootID:b.rootID};b.enterRoot(c)}),$("svg#"+b.rootID).on("mouseleave",function(a){var c={event:a,"this":this,rootID:b.rootID};b.leaveRoot(c)}),$("svg#"+b.rootID).on("scroll",function(a){var c={event:a,"this":this,rootID:b.rootID};b.scrollRoot(c)}),$("svg#"+b.rootID).on("mousedown",function(a){var c={event:a,"this":this,rootID:b.rootID};b.mousedownRoot(c)}),$("svg#"+b.rootID).on("mouseup",function(a){var c={event:a,"this":this,rootID:b.rootID};b.mouseupRoot(c)}),$("svg#"+b.rootID).on("click","use",function(a){var c={event:a,"this":this,rootID:b.rootID};b.clickObject(c)}),$("svg#"+b.rootID).on("mousemove","use",function(a){var c={event:a,"this":this,rootID:b.rootID};b.moveObject(c)}),$("svg#"+b.rootID).on("mouseenter","use",function(a){var c={event:a,"this":this,rootID:b.rootID};b.enterObject(c)}),$("svg#"+b.rootID).on("mouseleave","use",function(a){var c={event:a,"this":this,rootID:b.rootID};b.leaveObject(c)}),$("svg#"+b.rootID).on("scroll","use",function(a){var c={event:a,"this":this,rootID:b.rootID};b.scrollObject(c)}),$("svg#"+b.rootID).on("mouseup","use",function(a){var c={event:a,"this":this,rootID:b.rootID};b.mouseupObject(c)}),void $("svg#"+b.rootID).on("mousedown","use",function(a){var c={event:a,"this":this,rootID:b.rootID};b.mousedownObject(c)})):console.error("clickRegister() - no rootID")},this.fixSize=function(a){void 0!==a&&(b.sizeSettings||(b.sizeSettings={}),b.sizeSettings.fixSize=a===!0||!1,b.updateSizing())},this.setWidth=function(a){void 0!==a&&(b.sizeSettings||(b.sizeSettings={}),b.sizeSettings.width=a,b.updateSizing())},this.setHeight=function(a){void 0!==a&&(b.sizeSettings||(b.sizeSettings={}),b.sizeSettings.height=a,b.updateSizing())},this.setZoom=function(a){void 0!==a&&(b.sizeSettings||(b.sizeSettings={}),b.sizeSettings.zoom=a,b.updateSizing())},this.aspectRatio=function(a){void 0!==a&&(b.sizeSettings||(b.sizeSettings={}),b.sizeSettings.preserveAspectRatio=a,b.updateSizing())},void(this.updateSizing=function(){if(b.sizeSettings&&b.dataSettings){var a=document.querySelector("svg#"+b.rootID),c=null,d=null;b.sizeSettings.fixSize?(b.dataSettings.width&&(c=b.dataSettings.width),b.dataSettings.height&&(d=b.dataSettings.height)):(b.sizeSettings.width||b.sizeSettings.height)&&(b.sizeSettings.width&&(c=b.sizeSettings.width),b.sizeSettings.height&&(d=b.sizeSettings.height)),b.sizeSettings.zoom&&(c&&(c*=this.sizeSettings.zoom),d&&(d*=this.sizeSettings.zoom)),(c||d)&&(a.removeAttributeNS(null,"width"),a.removeAttributeNS(null,"height"),c&&a.setAttributeNS(null,"width",c),d&&a.setAttributeNS(null,"height",d)),a.removeAttributeNS(null,"preserveAspectRatio"),b.sizeSettings.preserveAspectRatio&&a.setAttributeNS(null,"preserveAspectRatio",b.sizeSettings.preserveAspectRatio)}})):console.error("vectic(): missing vecticID or templateID"):console.error("vectic(): missing target jQuery object")}var _vecticUID=0,_htmlBoiler='<span class="svgContainer">  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" id="{{ROOTID}}">    <defs id="palettes"></defs>    <defs id="templates"></defs>    <g id="objects"></g>    <g id="templates_edit"></g>  </svg></span>',_globalVecticStyler=".svgContainer {  -webkit-touch-callout: none !important;  -webkit-user-select: none !important;  -khtml-user-select: none !important;  -moz-user-select: none !important;  -ms-user-select: none !important;  user-select: none !important;}.svgContainer svg:not([width]) {  width: 100% !important;}";