"use strict";function _refError(a){console.error("Firebase refError()"),console.error(a)}function _vectic_template(a){var b=this;return this.refError=_refError,a=a||{},this.id=a.id||null,this.vecticid=a.vecticid||null,this.target=a.target||null,this.path=a.path||null,this.id?this.vecticid?this.target?this.path?this.target&&!this.target.html?console.error("vectic_template(): Target is not correct JQuery DOM object"):("undefined"!=typeof Firebase?this.firebaseLib=Firebase:console.error("_vectic_template(): could not find Firebase library"),this.onValue=function(a,c){var d=a.val(),e=a.key();if(!(d&&d.width&&d.height&&d.elements))return console.error("template "+e+" incomplete");var f="0 0 "+d.width+" "+d.height;b.target.get(0).setAttributeNS(null,"viewBox",f),d.palette&&b.target.get(0).setAttributeNS(null,"class","p"+d.palette);var g="";for(var h in d.elements){var i=d.elements[h];switch(i.tag){case"circle":if(!i.r)return;g+='<circle id="#t'+h+'" r="'+i.r+'"',i.color&&(g+=' class="c'+i.color+'"'),i.cx&&(g+=' cx="'+i.cx+'"'),i.cy&&(g+=' cy="'+i.cy+'"'),g+="></circle>";break;case"rect":if(!i.width||!i.height)return;g+='<rect id="#t'+h+'" width="'+i.width+'" height="'+i.height+'"',i.color&&(g+=' class="c'+i.color+'"'),i.x&&(g+=' x="'+i.x+'"'),i.y&&(g+=' y="'+i.y+'"'),g+="></rect>";break;default:console.error("Unknown element tag: "+i.tag)}}b.target.html(g)},this.destroy=function(){},this.templateDef=new this.firebaseLib(this.path+this.id),void this.templateDef.on("value",this.onValue,this.refError)):console.error("vectic_template(): No path supplied"):console.error("vectic_template(): No Target template element supplied"):console.error("vectic_template(): No Vectic ID supplied"):console.error("vectic_template(): No ID supplied")}function _vectic_palette(a){var b=this;return this.refError=_refError,a=a||{},this.id=a.id||null,this.vecticid=a.vecticid||null,this.target=a.target||null,this.path=a.path||null,this.id?this.vecticid?this.target?this.path?this.target&&!this.target.html?console.error("vectic_palette(): Target is not correct JQuery DOM object"):("undefined"!=typeof Firebase?this.firebaseLib=Firebase:console.error("_vectic_palette(): could not find Firebase library"),this.onValue=function(a,c){var d=a.val();if(d||!d.colors){var e="";for(var f in d.colors){var g=d.colors[f];e+=".p"+b.id+" .c"+f+" {",void 0!=g.fill&&(e+="fill:"+g.fill+";"),void 0!=g.stroke&&(e+="stroke:"+g.stroke+";"),void 0!=g["stroke-width"]&&(e+="stroke-width:"+g["stroke-width"]+";"),e+="} "}b.target.html(e)}},this.destroy=function(){},this.paletteDef=new this.firebaseLib(this.path+this.id),void this.paletteDef.on("value",this.onValue,this.refError)):console.error("vectic_palette(): No path supplied"):console.error("vectic_palette(): No Target palette element supplied"):console.error("vectic_palette(): No Vectic ID supplied"):console.error("vectic_palette(): No ID supplied")}function vectic(a){a=a||{};var b=this;return this.refError=_refError,this.targetObject=a.target,this.targetObjectSvg=null,this.vecticID=a.vecticID,this.firebaseLib=void 0,this.vecticRef=void 0,this.objects={},this.templates={},this.palettes={},this.objectContainerDom=null,this.templateContainerDom=null,this.paletteContainerDom=null,this.vecticTemplateHandlers={},this.vecticPaletteHandlers={},"undefined"!=typeof Firebase?this.firebaseLib=Firebase:console.error("vectic(): could not find Firebase library"),Object.defineProperty(this,"pathBase",{get:function(){return"http://vecticdev.firebaseio.com/"}}),Object.defineProperty(this,"pathVectic",{get:function(){return this.pathBase+"vectic/"}}),Object.defineProperty(this,"pathTemplate",{get:function(){return this.pathBase+"template/"}}),Object.defineProperty(this,"pathPalette",{get:function(){return this.pathBase+"palette/"}}),this.targetObject&&this.targetObject.html?this.vecticID?(this.rootID="v"+this.vecticID+"_id"+(_vecticUID+=1),this.init=function(){b.initHTML(),b.getDoms(),b.initFirebase()},this.initHTML=function(){return b.targetObject?(b.targetObject.html(_htmlBoiler.replace("{{ROOTID}}",b.rootID)),void(b.targetObjectSvg=$(b.targetObject).find("svg").get(0))):console.error("vectic: Target object missing")},this.getDoms=function(){b.objectContainerDom=$("svg#"+b.rootID+" g#objects").get(0),b.templateContainerDom=$("svg#"+b.rootID+" defs#templates").get(0),b.paletteContainerDom=$("svg#"+b.rootID+" defs#palettes").get(0)},this.getObjectsRef=function(){return b.vecticRef?b.vecticRef.child("objects"):console.error("vectic.getObjectsRef: Could not find vecticRef")},this.getTemplatesRef=function(){return b.vecticRef?b.vecticRef.child("templates"):console.error("vectic.getTemplatesRef: Could not find vecticRef")},this.getPalettesRef=function(){return b.vecticRef?b.vecticRef.child("palettes"):console.error("vectic.getPalettesRef: Could not find vecticRef")},this.initFirebase=function(){return b.firebaseLib?b.vecticID?(b.vecticRef=new b.firebaseLib(b.pathVectic+b.vecticID),b.vecticObjectsRef=b.getObjectsRef(),b.vecticTemplatesRef=b.getTemplatesRef(),b.vecticPalettesRef=b.getPalettesRef(),void b.setVecticHooks()):console.error("vectic: Missing vecticID"):console.error("vectic: Missing Firebase library")},this.setVecticHooks=function(){return b.vecticRef?(b.vecticPalettesRef.off("child_added",b.addPalette,b.refError),b.vecticTemplatesRef.off("child_added",b.addTemplate,b.refError),b.vecticObjectsRef.off("child_added",b.addObject,b.refError),b.vecticPalettesRef.on("child_added",b.addPalette,b.refError),b.vecticTemplatesRef.on("child_added",b.addTemplate,b.refError),b.vecticObjectsRef.on("child_added",b.addObject,b.refError),b.vecticRef.child("settings").off("value",b.settingsChange,b.refError),void b.vecticRef.child("settings").on("value",b.settingsChange,b.refError)):console.error("vectic: Could not create hooks, not connected to Database")},this.settingsChange=function(a){var c=a.val();if(!(c&&c.width&&c.height))return console.error("vectic settingsChange: missing width/height");var d="0 0 "+c.width+" "+c.height;b.targetObjectSvg.setAttributeNS(null,"viewBox",d)},this.newObjectDom=function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","use");return b.setAttributeNS(null,"id",a),b},this.addObject=function(a,c){var d=a.key(),e=a.val(),f=b.newObjectDom(d);b.setObjectAttributes(f,e),b.objectContainerDom&&$(b.objectContainerDom).append(f)},this.setObjectAttributes=function(a,b){a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#t"+b.template),a.setAttributeNS(null,"x",b.x||null),a.setAttributeNS(null,"y",b.y||null),a.setAttributeNS(null,"width",b.width||null),a.setAttributeNS(null,"height",b.height||null)},this.initTemplate=_vectic_template,this.addTemplate=function(a,c){var d=a.key(),e=a.val(),f=e.template,g=b.newTemplateDom(d);b.templateContainerDom&&$(b.templateContainerDom).append(g),b.vecticTemplateHandlers[d]&&b.vecticTemplateHandlers[d].destroy(),b.vecticTemplateHandlers[d]=new b.initTemplate({id:f,vecticid:b.vecticID,target:g,path:b.pathTemplate})},this.newTemplateDom=function(a){return $('<svg id="t'+a+'"></svg>')},this.initPalette=_vectic_palette,this.addPalette=function(a,c){var d=a.key(),e=a.val(),f=e.palette,g=b.newPaletteDom(d);b.paletteContainerDom&&$(b.paletteContainerDom).append(g),b.vecticPaletteHandlers[d]&&b.vecticPaletteHandlers[d].destroy(),b.vecticPaletteHandlers[d]=new b.initPalette({id:f,vecticid:b.vecticID,target:g,path:b.pathPalette})},void(this.newPaletteDom=function(a){return $('<style id="p'+a+'"></style>')})):console.error("vectic(): missing vecticID"):console.error("vectic(): missing target jQuery object")}var _vecticUID=0,_htmlBoiler="";_htmlBoiler+='<span class="svgContainer">',_htmlBoiler+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" id="{{ROOTID}}">',_htmlBoiler+='<defs id="palettes"></defs>',_htmlBoiler+='<defs id="templates"></defs>',_htmlBoiler+='<g id="objects"></g>',_htmlBoiler+="</svg>",_htmlBoiler+="<style>",_htmlBoiler+=".svgContainer {",_htmlBoiler+="-webkit-touch-callout: none !important;",_htmlBoiler+="-webkit-user-select: none !important;",_htmlBoiler+="-khtml-user-select: none !important;",_htmlBoiler+="-moz-user-select: none !important;",_htmlBoiler+="-ms-user-select: none !important;",_htmlBoiler+="user-select: none !important;",_htmlBoiler+="}",_htmlBoiler+=".svgContainer svg:not([width]) {",_htmlBoiler+="width: 100% !important;",_htmlBoiler+="}",_htmlBoiler+="</style>",_htmlBoiler+="</span>";